<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Mybatis | wuyp&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="基础 框架  软件开发中的一套解决方案，不同的框架解决不同的问题。mybatis层框架解决持久层问题。 框架封装了很多的细节，使开发者可以使用极简的方式实现功能。大大提供开发效率。   三层架构  表现层 展示数据   业务层 处理业务需求   持久层 和数据库交互        持久层技术解决方案  JDBC技术 Connection PreparedStatement ResultSet">
<meta property="og:type" content="article">
<meta property="og:title" content="Mybatis">
<meta property="og:url" content="http://example.com/2021/04/23/mybatis/index.html">
<meta property="og:site_name" content="wuyp&#39;s blog">
<meta property="og:description" content="基础 框架  软件开发中的一套解决方案，不同的框架解决不同的问题。mybatis层框架解决持久层问题。 框架封装了很多的细节，使开发者可以使用极简的方式实现功能。大大提供开发效率。   三层架构  表现层 展示数据   业务层 处理业务需求   持久层 和数据库交互        持久层技术解决方案  JDBC技术 Connection PreparedStatement ResultSet">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/wuyueping/images/raw/master/img/ssm_20210419230439.png">
<meta property="og:image" content="https://gitee.com/wuyueping/images/raw/master/img/20210423125125.png">
<meta property="article:published_time" content="2021-04-23T05:09:55.168Z">
<meta property="article:modified_time" content="2021-05-25T14:55:36.591Z">
<meta property="article:author" content="wuyp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/wuyueping/images/raw/master/img/ssm_20210419230439.png">
  
    <link rel="alternate" href="/atom.xml" title="wuyp&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:100,300,400,700&amp;subset=korean" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <!--<div id="banner"></div>-->
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        <a href="/" id="main-nav-title" class="main-nav-link">wuyp&#39;s blog</a>
        <div class="header_menu">
          
            <a class="main-nav-link" href="/">主页</a>
          
            <a class="main-nav-link" href="/archives/">归档</a>
          
            <a class="main-nav-link" href="/about/">关于.</a>
          
        </div>
      </nav>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-mybatis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Mybatis
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      <div class="article-entry-part">
        
          <h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><ul>
<li><p>框架</p>
<ul>
<li>软件开发中的一套解决方案，不同的框架解决不同的问题。mybatis层框架解决持久层问题。</li>
<li>框架封装了很多的细节，使开发者可以使用极简的方式实现功能。大大提供开发效率。</li>
</ul>
</li>
<li><p>三层架构</p>
<ul>
<li>表现层<ul>
<li>展示数据</li>
</ul>
</li>
<li>业务层<ul>
<li>处理业务需求</li>
</ul>
</li>
<li>持久层<ul>
<li>和数据库交互</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/wuyueping/images/raw/master/img/ssm_20210419230439.png" alt="image-20210419230431563"></p>
<ul>
<li><p>持久层技术解决方案</p>
<ul>
<li>JDBC技术<ul>
<li>Connection</li>
<li>PreparedStatement</li>
<li>ResultSet</li>
</ul>
</li>
<li>Spring的JdbcTemplate<ul>
<li>Spring中对jdbc的简单封装</li>
</ul>
</li>
<li>Apache的DButils<ul>
<li>也是对Jdbc的简单封装</li>
</ul>
</li>
</ul>
<p>——–只是工具类</p>
</li>
<li><p>mybatis框架概述</p>
<ul>
<li>基于Java的持久层框架，内部封装了jdbc，使开发者只需要关注sql语句本身，而不需要花费精力去处理加载驱动、创建连接、创建statement等繁杂的过程。</li>
<li>它使用了ORM思想实现了结果集的封装。</li>
<li>ORM object relational mapping 对象关系映射<ul>
<li>把数据库表和实体类及实体类的属性对应起来，让我们可以操作实体类就实现操作数据库表。</li>
</ul>
</li>
</ul>
</li>
<li><p>环境搭建</p>
<ul>
<li><input disabled="" type="checkbox"> 1、创建maven工程并导入坐标</li>
<li><input disabled="" type="checkbox"> 2、创建实体类和dao的接口</li>
<li><input disabled="" type="checkbox"> 3、创建mybatis的主配置文件 SqlMapConfig.xml</li>
<li><input disabled="" type="checkbox"> 4、创建映射配置文件 IUserDao.xml</li>
</ul>
</li>
</ul>
<p>注意事项</p>
<ul>
<li><input disabled="" type="checkbox"> 1、创建IUserDao.xml和 IUserDao.java 时名称是为了和我们之前的知识保持一致。在mybatis中它把持久层的操作接口名称和映射文件也叫做：Mapper。所以IUserDao 和 IUserMapper是一样的。</li>
<li><input disabled="" type="checkbox"> 2、idea中创建目录和包是不一样的。包在创建时co m.example.dao它是三级结构。目录在创建时com.example.dao是一级目录。</li>
<li><input disabled="" type="checkbox"> 3、mybatis的映射配置文件位置必须和dao接口的包结构相同。</li>
<li><input disabled="" type="checkbox"> 4、映射配置文件的mapper标签的namespace属性的取值必须是dao接口的全限定类名。</li>
<li><input disabled="" type="checkbox"> 5、映射配置文件的操作属性，id属性的取值必须是dao接口的方法名</li>
</ul>
<p>当遵从了三、四、五之后，开发中就无须再写dao的实现类。</p>
<h4 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a>入门案例</h4><p>SqlMapConfig.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mybatis主配置文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置mysql环境 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置事务类型 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置数据源(连接池)--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 配置连接数据库的4个基本信息 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/demo&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 指定映射配置文件的位置 映射配置文件指的是每个dao独立的配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/example/dao/IUserDao.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>main</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.读取配置文件</span></span><br><span class="line">InputStream in = Resources.getResourceAsStream(<span class="string">&quot;SqlMapConfig.xml&quot;</span>);</span><br><span class="line"><span class="comment">//2.创建 SqlSessionFactory 工厂</span></span><br><span class="line"><span class="comment">// mybatis 通过SqlSessionFactoryBuilder的build 解析配置文件、细节封装</span></span><br><span class="line">SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">SqlSessionFactory factory = builder.build(in);</span><br><span class="line"><span class="comment">//3.使用工厂生产SqlSession对象</span></span><br><span class="line">SqlSession sqlSession = factory.openSession();</span><br><span class="line"><span class="comment">//4.使用SqlSession创建Dao接口的代理对象</span></span><br><span class="line">IUserDao userDao = sqlSession.getMapper(IUserDao.class);</span><br><span class="line"><span class="comment">//5.使用代理对象执行方法</span></span><br><span class="line">List&lt;User&gt; users = userDao.findAll();</span><br><span class="line"><span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">System.out.println(user);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//6.释放资源</span></span><br><span class="line">sqlSession.close();</span><br><span class="line">in.close();</span><br></pre></td></tr></table></figure>

<p>注意事项</p>
<ul>
<li><input disabled="" type="checkbox"> 在映射配置中告知mybatis要封装到哪个实体类中； 配置的方式：指定实体类的全限定类名</li>
</ul>
<p>IUserDao.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.dao.IUserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置查询所有 resultXXXX 配置结果集封装到哪--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.domain.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="通过注解配置"><a href="#通过注解配置" class="headerlink" title="通过注解配置"></a>通过注解配置</h5><p>SqlMapConfig.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mybatis主配置文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置mysql环境 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置事务类型 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置数据源(连接池)--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 配置连接数据库的4个基本信息 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/demo&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 指定映射配置文件的位置 映射配置文件指的是每个dao独立的配置文件</span></span><br><span class="line"><span class="comment">            &lt;mapper resource=&quot;com/example/dao/IUserDao.xml&quot;/&gt;</span></span><br><span class="line"><span class="comment">        如果是用注解来配置的话，此处应该使用class属性指定被注解的dao的全限定类名</span></span><br><span class="line"><span class="comment">            &lt;mapper class=&quot;com.example.dao.IUserDao&quot;/&gt;</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.example.dao.IUserDao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>IUserDao.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuyueping</span></span><br><span class="line"><span class="comment"> * 用户的持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有操作</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from user&quot;)</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="写dao实现类的方式"><a href="#写dao实现类的方式" class="headerlink" title="写dao实现类的方式"></a>写dao实现类的方式</h5><p>UserDaoImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory factory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserDaoImpl</span><span class="params">(SqlSessionFactory factory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.factory = factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.使用工厂创建 SqlSession</span></span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        <span class="comment">//2.使用session执行查询所有方法</span></span><br><span class="line">        <span class="comment">// 不写语句 该为通过配置拿到语句</span></span><br><span class="line">        List&lt;User&gt; users = session.selectList(<span class="string">&quot;com.example.dao.IUserDao.findAll&quot;</span>);</span><br><span class="line">        session.close();</span><br><span class="line">        <span class="comment">//3.返回查询结果</span></span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第四步就可以不使用代理了 直接传factory到实现类</p>
<p>main</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> com.example.dao.impl.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//1.读取配置文件</span></span><br><span class="line">        InputStream in = Resources.getResourceAsStream(<span class="string">&quot;SqlMapConfig.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//2.创建 SqlSessionFactory 工厂</span></span><br><span class="line">        <span class="comment">// mybatis 通过SqlSessionFactoryBuilder的build 解析配置文件、细节封装</span></span><br><span class="line">        SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory factory = builder.build(in);</span><br><span class="line">        <span class="comment">//3.使用工厂生产SqlSession对象</span></span><br><span class="line">        SqlSession sqlSession = factory.openSession();</span><br><span class="line">        <span class="comment">//4.使用SqlSession创建Dao接口的代理对象</span></span><br><span class="line">        <span class="comment">// IUserDao userDao = sqlSession.getMapper(IUserDao.class);</span></span><br><span class="line">        IUserDao userDao = <span class="keyword">new</span> UserDaoImpl(factory);</span><br><span class="line">        <span class="comment">//5.使用代理对象执行方法</span></span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//6.释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/wuyueping/images/raw/master/img/20210423125125.png" alt="image-20210422114602540" style="zoom:50%;" />

<p>main代码分析</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.读取配置文件</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1、使用类加载器，它只能读取类路径的配置文件</span></span><br><span class="line"><span class="comment">2、使用servletContext对象的getRealPath()</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 绝对路径 、相对路径(X)</span></span><br><span class="line">InputStream in = Resources.getResourceAsStream(<span class="string">&quot;SqlMapConfig.xml&quot;</span>);</span><br><span class="line"><span class="comment">//2.创建 SqlSessionFactory 工厂</span></span><br><span class="line"><span class="comment">// mybatis 通过SqlSessionFactoryBuilder的build 解析配置文件、细节封装</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">创建工厂mybatis使用了[构建者模式]</span></span><br><span class="line"><span class="comment">构建者模式： SqlSessionFactor构建者 不用在意细节 只关注结果</span></span><br><span class="line"><span class="comment">优势：把对象的创建细节隐藏，使使用者直接调用方法即可拿到对象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">生产SqlSession使用了工厂模式</span></span><br><span class="line"><span class="comment">优势：解耦 降低类之间的依赖关系</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">getMapper 创建Da接口实现类代理模式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">SqlSessionFactory factory = builder.build(in);</span><br><span class="line"><span class="comment">//3.使用工厂生产SqlSession对象</span></span><br><span class="line">SqlSession sqlSession = factory.openSession();</span><br><span class="line"><span class="comment">//4.使用SqlSession创建Dao接口的代理对象</span></span><br><span class="line">IUserDao userDao = sqlSession.getMapper(IUserDao.class);</span><br><span class="line"><span class="comment">// IUserDao userDao = new UserDaoImpl(factory);</span></span><br><span class="line"><span class="comment">//5.使用代理对象执行方法</span></span><br><span class="line">List&lt;User&gt; users = userDao.findAll();</span><br><span class="line"><span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//6.释放资源</span></span><br><span class="line">sqlSession.close();</span><br><span class="line">in.close();</span><br></pre></td></tr></table></figure>



<h5 id="查询所有的分析"><a href="#查询所有的分析" class="headerlink" title="查询所有的分析"></a>查询所有的分析</h5><ul>
<li><input disabled="" type="checkbox"> mybatis 在使用代理dao的方式实现增删改查时做了什么 ?<ul>
<li><input disabled="" type="checkbox"> 1、创建代理对象</li>
<li><input disabled="" type="checkbox"> 2、在代理对象中调用selectList</li>
</ul>
</li>
</ul>
<p>执行查询的分析</p>
<ul>
<li><input disabled="" type="checkbox"> 读取配置文件<ul>
<li><input disabled="" type="checkbox"> 用到的技术就是解析XML的技术：此处用的是dom4j解析XML技术</li>
</ul>
</li>
</ul>
<p><strong>关键！！！</strong></p>
<ol>
<li><p><strong>连接信息</strong></p>
</li>
<li><p><strong>映射信息</strong></p>
<ul>
<li><strong>执行的SQL语句</strong></li>
<li><strong>封装结果的实体类全限定类名</strong></li>
</ul>
<p><strong>把这两个信息结合起来定义成一个对象</strong></p>
</li>
</ol>
<p>1、根据配置文件的信息创建connection对象</p>
<p>​    注册驱动、获取链接</p>
<p>2、获取预处理对象preparedstatement</p>
<p>​    此时需要SQL语句 conn.prepareStatement(sql)</p>
<p>3、执行查询</p>
<p>​    ResultSet resultSet = preparedStatement.executeQuery();</p>
<p>4、遍历结果集用于封装</p>
<p>​        List&lt; E &gt; list = new ArrayList&lt;&gt;();</p>
<p>​        while(resultSet.next()) {</p>
<p>​            E element = Class.forName(配置的全限定类名).newInstance() <em>反射封装</em></p>
<p>​            进行封装 把每个rs的内容都添加到element中</p>
<p>​            实体类属性和表中的列名是一致的。就可以把表中的列名看成是实体类的属性名称。就可以使用反射的方式来根据名称获取每个属性，并把值赋进去。</p>
<p>​            把element加入到list中</p>
<p>​            list.add(element)</p>
<p>​        }</p>
<p>5、返回list集合</p>
<h5 id="创建代理对象分析"><a href="#创建代理对象分析" class="headerlink" title="创建代理对象分析"></a>创建代理对象分析</h5><p>根据dao接口的字节码创建dao的代理对象</p>
<p>getMapper {</p>
<p>/*</p>
<p>类加载器：使用的和被代理对象是相同的类加载器</p>
<p>代理对象要实现的接口：和被代理对象实现相同的接口</p>
<p>如何代理：增强的方法。此处是一个InvocationHandler的接口，需要写一个该接口的实现类，在实现类中调用selectList方法</p>
<p>*/</p>
<p>Proxy.newProxyInstance(类加载器，代理对象要实现的接口字节码数组)</p>
<p>}</p>
<h5 id="自定义mybatis"><a href="#自定义mybatis" class="headerlink" title="自定义mybatis"></a>自定义mybatis</h5><table>
<thead>
<tr>
<th>class</th>
<th>Resources</th>
</tr>
</thead>
<tbody><tr>
<td>class</td>
<td>SqlSessionFactoryBuilder</td>
</tr>
<tr>
<td>interface</td>
<td>SqlSessionFactory</td>
</tr>
<tr>
<td>interface</td>
<td>SqlSession</td>
</tr>
</tbody></table>
<p>去掉</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>增加</p>

        
      </div>
      
      <aside id="article-toc" role="navigation" class="fixed" >
    <div id="article-toc-inner">
        <strong class="sidebar-title">文章目录</strong>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">入门案例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE"><span class="toc-text">通过注解配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%99dao%E5%AE%9E%E7%8E%B0%E7%B1%BB%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">写dao实现类的方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E7%9A%84%E5%88%86%E6%9E%90"><span class="toc-text">查询所有的分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1%E5%88%86%E6%9E%90"><span class="toc-text">创建代理对象分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89mybatis"><span class="toc-text">自定义mybatis</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>
</aside>
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/23/mybatis/" data-id="ckozg9m3p0002lq7dde573v4l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/04/26/web%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80/" id="article-nav-newer" class="article-nav-link-wrap">
      <span class="article-nav-caption">Newer</span>
      <div class="article-nav-title">
        
          web项目基础
        
      </div>
    </a>
  
  
    <a href="/2021/04/23/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-caption">Older</span>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 wuyp<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> with 
      theme_by <a href="http://hexo.io/" target="_blank">mango</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">主页</a>
  
    <a href="/archives/" class="mobile-nav-link">归档</a>
  
    <a href="/about/" class="mobile-nav-link">关于.</a>
  
</nav>
    


<script src="//code.jquery.com/jquery-2.0.3.min.js"></script>

  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>